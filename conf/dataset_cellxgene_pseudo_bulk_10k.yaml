# Example dataset configuration demonstrating simplified structure
# Inherits directly from dataset_default.yaml
defaults:
  - dataset_default.yaml
  - _self_

# =============================================================================
# DATASET METADATA
# =============================================================================
dataset:
  name: "cellxgene_pseudo_bulk_10k"
  description: "CellxGene pseudo bulk dataset with 10k samples. Annotated with natural language descriptions obtained in CellWhisperer Study."
  download_url: "https://medical-epigenomics.org/papers/schaefer2024/data/datasets/cellxgene_census/full_data.h5ad" # Example URL
  full_name: "cellxgene_pseudo_bulk_full"

# =============================================================================
# COMMON KEYS (dataset-specific)
# =============================================================================
batch_key: "dataset_title"
annotation_key: "cell_type"
caption_key: "natural_language_annotation"
instrument_key: "assay"
other_bio_labels: ["tissue", "disease"]

# =============================================================================
# DATASET-SPECIFIC OVERRIDES
# =============================================================================
# Download configuration
# Downloads run locally since we have internet access on the local machine
download:
  enabled: false
  execution_location: local # Download data on local machine
  subset_size: 10000

# Preprocessing overrides (both dataset-specific and execution parameters)
# Preprocessing can run on CPU cluster for larger datasets
preprocessing:
  enabled: false
  execution_location: cpu # Run on CPU cluster
  chunk_size: 10000
  split_dataset: true # Important for training datasets. Set to false for test datasets.
  count_layer_key: "counts" # Key in adata.layers with raw counts. If not present, adata.raw.X is checked.

# Embedding preparation overrides
# Preparation runs on CPU cluster

# Embedding overrides (both dataset-specific and execution parameters)
# CPU embeddings run on CPU cluster
embedding_cpu:
  enabled: false
  execution_location: cpu # CPU methods run on CPU cluster
  overwrite: true
  venv_path: ".venv"
  methods: ["gs10k"]

# GPU embeddings run on GPU cluster
embedding_gpu:
  enabled: false
  execution_location: gpu # GPU methods run on GPU cluster (with automatic data transfer)
  overwrite: true
  venv_path: "cw_gf"
  methods: ["cw-geneformer"]
  # Init kwargs passed to all embedders (unused kwargs are ignored by other methods)
  # For cw-geneformer, you can just pass cw_model_path - other embedders will ignore it
  # Relative paths are resolved relative to PROJECT_DIR (set in workflow_orchestrator.yaml)
  init_kwargs:
    cw_model_path: "external/Geneformer_v1/geneformer-12L-30M" # Relative to project_directory
    # Optional: override processor and model config defaults
    # processor_kwargs:
    #   nproc: 4
    #   emb_label: ["sample_name"]
    # model_config:
    #   emb_mode: "cell"
    #   emb_layer: -1
    #   forward_batch_size: 16

# Dataset creation overrides
# Final dataset creation runs on CPU cluster
dataset_creation:
  enabled: true
  execution_location: cpu # Create dataset on CPU cluster
  use_nextcloud: false
  use_zenodo: true
  # Dataset-specific parameters
  required_obsm_keys: ["X_pca", "X_scvi_fm", "X_gs10k"] #, "X_geneformer"]
  cs_length: 4096
  caption_keys: ["caption_key"]
  negatives_per_sample: 2
  split_dataset: true # Important for training datasets. Set to false for test datasets.
  dataset_format: "multiplets" # Important for training datasets. Set to "single" for test datasets.
