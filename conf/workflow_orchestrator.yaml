# Workflow Orchestrator Configuration
# This config contains settings for the workflow orchestrator only
# Dataset configs should be specified separately via command line

# =============================================================================
# WORKFLOW MODE CONFIGURATION
# =============================================================================
workflow:
  # Default execution mode: "local" | "cpu" | "gpu"
  # Used as fallback when a step doesn't specify execution_location
  # For backward compatibility: "slurm" is treated as "cpu"
  default_execution_location: local

  # =============================================================================
  # LOCATION-SPECIFIC CONFIGURATIONS
  # =============================================================================
  # Each location defines connection settings, paths, and resources
  # Steps can run on any location by setting execution_location in dataset config
  locations:
    # Local machine configuration
    local:
      # No SSH needed for local execution
      base_file_path: "./data/RNA"
      project_directory: "."
      venv_path: ".venv"
      output_directory: "./outputs"
      # Local execution settings
      max_workers: 2 # Maximum parallel workers for array tasks
      enable_gpu: true # Enable GPU embedding locally (disable for laptops)

    # CPU cluster configuration
    cpu:
      # SSH connection settings (using SSH aliases from ~/.ssh/config)
      ssh_host: "imbi13"
      ssh_user: "menger"
      # SLURM settings
      slurm_partition: "slurm"
      node: "imbi223-hpc" # Optional: constrain to specific node, null for any
      # Paths on the CPU cluster
      base_file_path: "/scratch/global/menger/data/RNA"
      project_directory: "/home/menger/git/adata_hf_datasets"
      venv_path: ".venv"
      output_directory: "/home/menger/git/adata_hf_datasets/outputs"

    # GPU cluster configuration
    gpu:
      # SSH connection settings (using SSH aliases from ~/.ssh/config)
      ssh_host: "imbi_gpu_H100"
      ssh_user: "menger"
      # SLURM settings
      slurm_partition: "gpu"
      node: null # Optional: constrain to specific node, null for any
      # Paths on the GPU cluster
      base_file_path: "/scratch/global/menger/data/RNA"
      project_directory: "/home/menger/git/adata_hf_datasets"
      venv_path: ".venv"
      output_directory: "/home/menger/git/adata_hf_datasets/outputs"

  # =============================================================================
  # DATA TRANSFER CONFIGURATION
  # =============================================================================
  # Settings for automatic data transfer between locations
  transfer:
    # Enable automatic transfer when consecutive steps run on different locations
    enabled: true
    # Use tar.gz compression for zarr directories (many small files)
    compression: true
    # Compression level (1-9, higher = smaller but slower)
    compression_level: 6
    # Verify file integrity after transfer using checksums
    verify_integrity: true
    # For remote-to-remote transfers (e.g., CPU to GPU):
    # - false: Use SSH agent forwarding for direct transfer (faster, requires SSH agent)
    # - true: Transfer via local machine as intermediary (slower, more reliable)
    remote_to_remote_via_local: false
    # Temporary directory for compressed archives
    temp_dir: "/tmp/workflow_transfer"
    # Cleanup temporary files after successful transfer
    cleanup_temp: true
    # rsync options
    rsync_options:
      - "--archive" # Preserve permissions, timestamps, etc.
      - "--compress" # Compress during transfer
      - "--partial" # Keep partially transferred files for resume
      - "--progress" # Show progress
      - "--human-readable"

  # =============================================================================
  # JOB MONITORING SETTINGS
  # =============================================================================
  # Job polling interval (seconds)
  # How often the orchestrator checks if a submitted job has finished
  poll_interval: 120 # Check every 2 minutes

  # Timeout for job completion (seconds, 0 = no timeout)
  # Maximum time to wait for a job to complete before timing out
  job_timeout: 0 # No timeout (wait indefinitely)

# =============================================================================
# ORCHESTRATOR SETTINGS
# =============================================================================
# Force flag to skip config synchronization validation
force: false

# Dataset config name to use (will be overridden by command line)
dataset_config_name: null
