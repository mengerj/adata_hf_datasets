# Example dataset configuration demonstrating simplified structure
# Inherits directly from dataset_default.yaml
defaults:
  - dataset_default.yaml
  - _self_

# =============================================================================
# DATASET METADATA
# =============================================================================
dataset:
  name: "cxg_pseudo_bulk_full"
  description: "CellxGene pseudo bulk dataset with 350k samples. Annotated with natural language descriptions obtained in CellWhisperer Study."
  download_url: "https://medical-epigenomics.org/papers/schaefer2024/data/datasets/cellxgene_census/full_data.h5ad" # Example URL
  full_name: "cellxgene_pseudo_bulk_full"

# =============================================================================
# COMMON KEYS (dataset-specific)
# =============================================================================
batch_key: "dataset_title"
annotation_key: "cell_type"
caption_key: "natural_language_annotation"
instrument_key: "assay"
other_bio_labels: ["tissue", "disease"]

# =============================================================================
# DATASET-SPECIFIC OVERRIDES
# =============================================================================
# Download configuration
download:
  enabled: false
  subset_size: null

# Preprocessing overrides (both dataset-specific and execution parameters)
preprocessing:
  # Dataset-specific parameters
  enabled: false
  chunk_size: 100000 #small to test many chunks
  split_dataset: true # Important for training datasets. Set to false for test datasets. (Similar parameters in dataset_creation)
  count_layer_key: "counts" # Key in adata.layers with raw counts. If not present, adata.raw.X is checked.
  # Layer management - example of removing replicate layers
  layers_to_delete: [
      "replicate_1",
      "replicate_2",
      "replicate_3",
      "replicate_4",
      "replicate_5",
    ] # Remove replicate layers to reduce file size
# Embedding preparation overrides
embedding_preparation:
  enabled: false # Set to false to skip embedding preparation
  methods: ["geneformer", "geneformer-v1"] #run the prepare step on cpu to save gpu time

# Embedding overrides (both dataset-specific and execution parameters)
embedding_cpu:
  enabled: false
  overwrite: false
  methods: ["gs10k", "scvi_fm", "pca"] #, "scvi_fm", "gs", "gs10k"]

embedding_gpu:
  enabled: false
  venv_path: "cw-geneformer"
  methods: ["cw-geneformer"]

# Dataset creation overrides
dataset_creation:
  enabled: true
  use_nextcloud: false
  use_zenodo: true
  force_reupload: true
  private: false
  attributes_to_remove:
    - "raw"
    - "uns/log1p/base"
  # Dataset-specific parameters
  required_obsm_keys:
    [
      "X_pca",
      "X_scvi_fm",
      "X_geneformer",
      "X_gs10k",
      "X_geneformer-v1",
      "X_cw-geneformer",
    ]
  cs_length: 4096
  caption_keys: "caption_key"
  negatives_per_sample: 2
  dataset_format: "multiplets" # Important for training datasets. Set to "single" for test datasets.
