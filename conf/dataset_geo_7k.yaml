# Example dataset configuration demonstrating simplified structure
# Inherits directly from dataset_default.yaml
defaults:
  - dataset_default.yaml
  - _self_

# =============================================================================
# DATASET METADATA
# =============================================================================
dataset:
  name: "geo_7k" #name of the subset being used
  description: "GEO dataset with 7k samples. Annotated with natural language descriptions obtained in CellWhisperer Study."
  download_url: "https://medical-epigenomics.org/papers/schaefer2024/data/datasets/archs4_geo/full_data.h5ad" # Example URL
  full_name: "geo_700k" #name of the full dataset

# =============================================================================
# COMMON KEYS (dataset-specific)
# =============================================================================
batch_key: "study"
annotation_key: null
caption_key: "natural_language_annotation"
instrument_key: "instrument_model"
other_bio_labels: []

# =============================================================================
# DATASET-SPECIFIC OVERRIDES
# =============================================================================
# Download configuration
download:
  enabled: false
  subset_size: 7000

# Preprocessing overrides (both dataset-specific and execution parameters)
preprocessing:
  # Dataset-specific parameters
  enabled: false
  chunk_size: 100000
  split_dataset: true # Important for training datasets. Set to false for test datasets. (Similar parameters in dataset_creation)
  count_layer_key: "counts" # Key in adata.layers with raw counts. If not present, adata.raw.X is checked.
  # Bimodal splitting (for specific datasets)
  split_bimodal: true
  bimodal_col: readsaligned

  # SRA metadata fetching (dataset-specific)
  skip_sra_fetch: false
  sra_max_retries: 3
  sra_continue_on_fail: true
  sra_chunk_size: 10000
  sra_extra_cols: ["instrument_model", "library_layout"]

# Embedding preparation overrides
embedding_preparation:
  enabled: false # Set to false to skip embedding preparation
  methods: ["geneformer"] #run the prepare step on cpu to save gpu time

# Embedding overrides (both dataset-specific and execution parameters)
embedding_cpu:
  enabled: false
  methods: ["hvg", "pca", "scvi_fm"]

embedding_gpu:
  enabled: false
  methods: ["geneformer"]

# Dataset creation overrides
dataset_creation:
  enabled: true
  use_nextcloud: true
  # Dataset-specific parameters
  required_obsm_keys: ["X_pca", "X_scvi_fm", "X_hvg", "X_geneformer"]
  cs_length: 512
  negatives_per_sample: 2
  split_dataset: true # Important for training datasets. Set to false for test datasets.
  dataset_format: "multiplets" # Important for training datasets. Set to "single" for test datasets.
